CONTEXTE PROJET : SiteVoice AI (Version 3.0 - Hybrid Ecosystem)

DESCRIPTION

√âcosyst√®me SaaS B2B complet.

Mobile (Flutter) : Outil de capture Terrain (Offline-first, Audio, GPS).

Web (Next.js) : Tour de Contr√¥le Manager (Admin, Billing, SEO, Analytics).

Backend (Supabase) : Cerveau central et Source de V√©rit√©.

üèóÔ∏è STACK TECHNIQUE HYBRIDE

üì± MOBILE (Terrain)

Tech : Flutter (Stable).

R√¥le : Capture de donn√©es haute fid√©lit√©.

Architecture : MVVM + Provider.

Libs Cl√©s : record (Audio), geolocator (GPS), hive (Offline), url_launcher (Redirection Web).

üíª WEB (Dashboard & Acquisition)

Tech : Next.js 14 (App Router) + TypeScript.

R√¥le : Administration, Data Viz, Facturation, Landing Pages (SEO).

UI Libs : Tailwind CSS, shadcn/ui, Lucide Icons, Recharts.

Payment : Stripe Checkout & Customer Portal (Natif).

‚òÅÔ∏è BACKEND (Shared Brain)

Supabase : Postgres, Auth, Storage, Realtime.

Logic : Edge Functions (Deno) pour tout traitement m√©tier partag√© (IA, Calculs complexes).

‚ö†Ô∏è R√àGLES D'ARCHITECTURE (DO OR DIE)

1. S√©paration des Responsabilit√©s (Separation of Concerns)

Mobile (Flutter) : NE FAIT PAS d'admin (pas de modif de factures, pas de gestion d'√©quipe). Il ne sert qu'√† cr√©er des rapports.

Web (Next.js) : NE FAIT PAS d'enregistrement audio (trop risqu√© via navigateur). Il sert √† traiter et payer.

Supabase : Contient TOUTE la logique de validation de donn√©es (via RLS et Triggers). Ne jamais faire confiance au frontend pour les calculs de prix.

2. Flux de Paiement (Web-Driven)

Mobile : Le bouton "Upgrade" ouvre https://app.sitevoice.ai/dashboard/billing via url_launcher.

Web : G√®re l'int√©gration Stripe Checkout, les Webhooks et les factures PDF.

Sync : Le Web met √† jour users.subscription_status. Le Mobile √©coute ce champ en Realtime pour se d√©bloquer.

3. Internationalization (Sync)

R√®gle : Les cl√©s de traduction doivent √™tre identiques entre fr.arb (Flutter) et fr.json (Next-intl) pour maintenir la coh√©rence s√©mantique.

4. Code Sharing (Mental Model)

Tu ne peux pas partager de code (Dart vs TS).

Strat√©gie : Si une logique fait plus de 10 lignes (ex: algorithme de pricing), elle DOIT √™tre une Postgres Function ou une Edge Function.

SCOPE FONCTIONNEL PAR PLATEFORME

üì± Flutter (Technicien)

Onboarding : Wizard -> Import Contacts -> Redirection Web OTO.

Capture : Audio (10min max, M4A) + Photo + GPS.

Sync : Queue Offline (Hive) -> Upload background.

UX : Gros boutons, Haptic feedback, Dark mode forc√©.

üíª Next.js (Manager/Patron)

Dashboard : KPIs temps r√©el (SWR / Supabase Realtime).

Map View : Leaflet Cluster Map des interventions.

Billing : Gestion CB, Factures, Plan Annuel.

SEO Pages : /solutions/plombier, /solutions/electricien (Programmatic SEO).

‚ö†Ô∏è R√àGLES CRITIQUES DE D√âVELOPPEMENT

1. R√®gle du "Hard Cap" Audio (Mobile)

Timer 10 min strict. Format M4A (AAC-LC) 16kHz Mono.

2. Architecture Realtime (Anti-Timeout)

Mobile : Upload -> Insert DB.

Backend : Trigger -> Edge Function (IA Processing).

Web & Mobile : Stream Update UI (Feedback visuel "Traitement en cours...").

3. S√©curit√© IA (RAG)

Le Prompt GPT-4o re√ßoit les clients et products minifi√©s.

Seuil confiance < 90% = Flag requires_clarification.

STYLE DE CODE

Flutter

MVVM, Widgets atomiques, pas de logique m√©tier dans l'UI.

Dossiers : lib/presentation, lib/data, lib/core.

Next.js

Server Components par d√©faut (RSC).

Client Components ("use client") uniquement pour l'interactivit√©.

Dossiers : app/, components/ui (shadcn), lib/supabase.

PRIORIT√âS UX

Mobile : Vitesse de capture (1 clic).

Web : Clart√© des donn√©es (Data Viz) et fluidit√© du paiement.

Global : Si l'utilisateur change son abonnement sur le Web, le Mobile doit se mettre √† jour en < 1 seconde (Realtime).